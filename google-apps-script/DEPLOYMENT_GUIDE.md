# Google Apps Script 部署指南 - 任務 4.1

## 📋 任務目標

實作 doGet 函數來讀取設定資料，包括：
- ✅ 讀取設定工作表的今日餐廳和菜單圖片網址
- ✅ 實作 parseMealsData 函數篩選今日餐廳的餐點
- ✅ 實作 parseAddonsData 函數篩選今日餐廳的加購項目
- ✅ 組合並回傳 JSON 格式的設定資料

## 步驟 1: 開啟 Apps Script 編輯器

1. 開啟你剛才建立的 Google Sheet「安親班訂便當系統」
2. 點擊上方選單：**擴充功能** → **Apps Script**
   - 如果找不到「擴充功能」，試試看「工具」→「指令碼編輯器」
3. 會開啟一個新視窗，這就是 Apps Script 編輯器

## 步驟 2: 貼上程式碼

1. 在 Apps Script 編輯器中，你會看到預設的程式碼：
   ```javascript
   function myFunction() {
     
   }
   ```

2. **全選並刪除**這段預設程式碼

3. 開啟專案中的 `google-apps-script/Code.gs` 檔案

4. **複製全部內容**並貼到 Apps Script 編輯器中

5. 點擊上方的「磁碟」圖示或按 `Ctrl+S` (Mac: `Cmd+S`) 儲存

6. 第一次儲存會要求輸入專案名稱：
   - 輸入：**訂便當系統 API**
   - 點擊「確定」

## 步驟 3: 測試 doGet 函數

在部署之前，我們先測試函數是否正常運作：

1. 在 Apps Script 編輯器上方，找到函數選擇下拉選單
2. 選擇 **doGet** 函數
3. 點擊「執行」按鈕（播放圖示）

4. **第一次執行會要求授權**：
   - 點擊「檢查權限」
   - 選擇你的 Google 帳號
   - 會出現警告「Google 尚未驗證這個應用程式」
   - 點擊「進階」
   - 點擊「前往『訂便當系統 API』(不安全)」
   - 點擊「允許」

5. 執行完成後，點擊下方的「執行記錄」查看結果

6. 如果看到類似這樣的輸出，表示成功：
   ```
   執行記錄
   ```

## 步驟 4: 測試輔助函數

讓我們也測試一下 parseMealsData 和 parseAddonsData 函數：

1. 在函數選擇下拉選單中選擇 **parseMealsData**
2. 點擊「執行」
3. 查看執行記錄，確認沒有錯誤

4. 重複上述步驟測試 **parseAddonsData**

## 步驟 5: 驗證程式碼

檢查清單：
- [ ] 程式碼已成功貼入 Apps Script 編輯器
- [ ] 專案已命名為「訂便當系統 API」
- [ ] 已完成授權流程
- [ ] doGet 函數可以成功執行
- [ ] parseMealsData 函數可以成功執行
- [ ] parseAddonsData 函數可以成功執行
- [ ] 執行記錄中沒有錯誤訊息

## 🎯 預期結果

當 doGet 函數執行成功時，它會：

1. 從「設定」工作表讀取：
   - 今日餐廳名稱（A2）
   - 菜單圖片網址（B2）

2. 從「餐點」工作表讀取並篩選：
   - 只保留今日餐廳的餐點
   - 解析備註選項（逗號分隔）
   - 解析加購項目ID（逗號分隔）

3. 從「加購」工作表讀取並篩選：
   - 只保留今日餐廳的加購項目

4. 組合資料並回傳 JSON 格式：
   ```json
   {
     "success": true,
     "data": {
       "restaurantName": "美味麵館",
       "menuImageUrl": "https://...",
       "meals": [
         {
           "id": "meal_001",
           "name": "紅燒牛肉麵",
           "price": 80,
           "options": ["加辣", "粗麵", "細麵"],
           "addons": [
             { "id": "addon_001", "name": "加麵", "price": 10 },
             { "id": "addon_002", "name": "焗烤", "price": 20 }
           ]
         },
         ...
       ]
     }
   }
   ```

## 🐛 故障排除

### 錯誤：找不到「設定」工作表
**原因：** 工作表名稱不正確
**解決方法：** 確認 Google Sheet 中的工作表名稱完全一致（包含中文字）

### 錯誤：請在設定工作表的 A2 儲存格填入今日餐廳名稱
**原因：** A2 儲存格是空的
**解決方法：** 在「設定」工作表的 A2 儲存格填入餐廳名稱（例如：美味麵館）

### 錯誤：Cannot read property
**原因：** 資料格式不正確
**解決方法：** 
- 確認「餐點」工作表的資料從第 2 行開始
- 確認「加購」工作表的資料從第 2 行開始
- 確認沒有空白行

### 執行時沒有任何輸出
**原因：** 可能是授權問題
**解決方法：** 重新執行授權流程

## ✅ 完成確認

當你完成以下所有項目，任務 4.1 就完成了：

- [ ] Apps Script 程式碼已貼入並儲存
- [ ] doGet 函數可以成功執行
- [ ] parseMealsData 函數可以成功執行
- [ ] parseAddonsData 函數可以成功執行
- [ ] 沒有錯誤訊息

## 📝 下一步

完成任務 4.1 後，我們會繼續：
- **任務 4.2**: 實作 doPost 函數寫入訂單資料
- **任務 4.3**: 部署為 Web App 並取得 URL

請告訴我當你完成這些步驟後的結果！
