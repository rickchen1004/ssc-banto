# 餐廳管理功能部署指南

## 📋 前置檢查

確認你的 Google Sheet「設定」工作表有以下結構：

| A | B | C |
|---|---|---|
| 餐廳名稱 | 菜單圖片網址 | 啟用 |
| 黃加雞腿 | https://... | FALSE |
| 徐家飯卷 | https://... | FALSE |
| 陳師傅原汁牛肉麵 | https://... | FALSE |

✅ 你的 Google Sheet 已經有正確的結構！

## 🔧 部署步驟

### 步驟 1: 更新 Google Apps Script

1. 打開你的 Google Sheet
2. 點擊「擴充功能」→「Apps Script」
3. 複製以下檔案的內容到對應的檔案：
   - `google-apps-script/Code.gs` → 覆蓋現有的 `Code.gs`
   - `google-apps-script/TEST_RESTAURANTS.gs` → 新增檔案（點擊「+」→「指令碼」）

### 步驟 2: 測試 API

在 Apps Script 編輯器中：

1. 選擇函數：`testGetRestaurants`
2. 點擊「執行」
3. 查看「執行記錄」（Ctrl+Enter 或 Cmd+Enter）
4. 應該會看到你的餐廳列表

**預期輸出：**
```
✅ 測試成功！

📊 餐廳列表：
  餐廳 1: 黃加雞腿
    圖片: https://...
    啟用: 否
  
  餐廳 2: 徐家飯卷
    圖片: https://...
    啟用: 否
  
  餐廳 3: 陳師傅原汁牛肉麵
    圖片: https://...
    啟用: 否
```

### 步驟 3: 重新部署 Web App

1. 在 Apps Script 編輯器中，點擊右上角「部署」→「管理部署」
2. 點擊現有部署旁的「編輯」（鉛筆圖示）
3. 在「版本」下拉選單中選擇「新版本」
4. 點擊「部署」
5. 複製新的 Web App URL（如果有變更）

### 步驟 4: 測試前端

1. 訪問 `http://localhost:5173/admin`
2. 輸入管理員密碼
3. 點擊「餐廳管理」
4. 應該會看到你的餐廳列表，包含：
   - 餐廳名稱
   - 縮圖
   - 開關按鈕

## 🧪 測試切換功能

1. 在餐廳列表中，點擊任一餐廳的開關按鈕
2. 應該會看到「更新成功」的通知
3. 該餐廳的開關會變成藍色（啟用狀態）
4. 其他餐廳的開關會自動關閉
5. 回到首頁 `/`，應該會看到該餐廳的菜單

## ❌ 故障排除

### 問題 1: 顯示「Error: 尚未開放點餐」

**原因：** API 調用失敗或 Google Apps Script 還沒更新

**解決方法：**
1. 確認已更新 `Code.gs`
2. 確認已重新部署 Web App（步驟 3）
3. 在 Apps Script 中執行 `testGetRestaurants` 測試

### 問題 2: 顯示「載入失敗」

**原因：** API URL 未設定或錯誤

**解決方法：**
1. 檢查 `.env` 檔案中的 `VITE_GOOGLE_SCRIPT_URL`
2. 確認 URL 是最新的 Web App URL
3. 重新啟動開發伺服器：`npm run dev`

### 問題 3: 開關按鈕無法切換

**原因：** POST API 未正確處理

**解決方法：**
1. 在 Apps Script 中執行 `testToggleRestaurant` 測試
2. 修改函數中的餐廳名稱為你的餐廳
3. 查看執行記錄是否有錯誤

### 問題 4: 圖片無法顯示

**原因：** 圖片 URL 無效或有 CORS 限制

**解決方法：**
1. 確認圖片 URL 可以在瀏覽器中直接開啟
2. 使用支援 CORS 的圖片來源（如 Unsplash、Imgur）
3. 或使用 Google Drive 分享連結

## 📝 使用說明

### 管理員操作流程：

1. **訪問管理頁面**：`/admin`
2. **輸入密碼**：使用 `.env` 中設定的 `VITE_ADMIN_PASSWORD`
3. **選擇功能**：
   - 餐廳管理：控制今日開放的餐廳
   - 菜單匯入：匯入新的菜單資料
4. **切換餐廳**：
   - 點擊開關按鈕啟用餐廳
   - 系統會自動關閉其他餐廳
   - 學生端會立即看到變更

### 學生端效果：

- **有餐廳啟用**：顯示該餐廳的菜單和訂餐表單
- **無餐廳啟用**：顯示「尚未開放點餐」訊息

## 🎉 完成！

部署完成後，你就可以：
- 在管理頁面控制餐廳開關
- 不需要手動編輯 Google Sheets
- 即時切換今日供應的餐廳
